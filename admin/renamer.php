<?

include "../func.php";

$num=0;

$info="
370263013 Светильник подвесной CARAMEL 6x40W 230V
405231713 Светильник подвесной Nikos nickel 1x35W
403836013 Светильник потолочный ROSARIO 4x40W 2
431497513 светильник настольный BOYCE 1x40W 230V
403846013 Светильник потолочный ROSARIO 9x40W 2
431474813 Светильник настольный BUCKET 1x40W 230V
370283013 Светильник напольный CARAMEL 5x40W 230
372271113 светильник настенный CAVALLI2x9W 230V
302610613 светильник настенный AUDREY1x8W 230V
302611713 Светильник настенный AUDREY nickel 1x8W
302634313 светильник потолочный RAMEAU2x60W 230
370253013 Светильник подвесной CARAMEL 3x40W 230V
370293013 Светильник настольный CARAMEL 3x40W 230V
375668713 Светильник подвесной CASTELLO 5x40W 230V
375678713 Бра CASTELLO wall lamps grey 1x40W 230V
374878613 Бра FOSTER wall lamps rust 1x60W 230V
459383113 Светильник настольный TEMPLE 1x75W 230V
301991813 Светильник потолочный FAITH White 1x10
370551113 Светильник потолочный GLADYS 5x20W 1
555144813 Светильник потолочный PARABOLIC alum 4
361091113 Светильник настольный DUBOIS 1x100W 230
421474313 Светильник напольный VIOLLA Brown 1x60W
302601713 светильник настенный AUDREY1x13W 230V
362513013 светильник подвесной KYRAN 1x60W 230V
372749213 светильник настольный RAMEAU1x60W 230V
421803813 Светильник напольный CASSIE 3x40W 230V
431771713 Светильник настольный SHALLOW 2x40W 230
370758613 Светильник подвесной STREAM 5x40W 230V
370781713 Светильник напольный STREAM 2x40W 230
370761713 Светильник потолочный STREAM 6x40W 2
375658713 Светильник подвесной CASTELLO 9x40W 230V
403521713 Светильник подвесной MERCURY 1x150W 230V
302063013 Светильник потолочный ALEXA 1x60W 230
403311713 Светильник подвесной CATALINA 1x55W 230V
670111713 Светильник настольный SINGER 1x50W 12V
372583113 светильник напольный FINN3x23W230V1x35W
405241713 светильник подвесной NIKOS 3x35W 230V
421593013 светильник напольный ALLEGRI1x60W 230V
431593013 светильник настольный ALLEGRI1x40W 230V
371053013 светильник подвесной VIADANA 1x60W 230V
302089313 Светильник потолочный CELESTE antr 2x23
302071113 Светильник потолочный CANDACE 1x40W
374461113 Светильник напольный FESTA 10x10W 12V
421351113 Светильник напольный MISTERY 1x300W 2
563844813 Светильник подвесной PERCY 4x42W 230V
421574313 Светильник напольный KASPAR Brown 3x100
431474313 Светильник настольный BUCKET 1x40W 230V
403484313 Светильник подвесной CLOVE 3x60W 230
561544813 Светильник точечный VENUS grey 4x50W 230
374833013 Светильник напольный FLORA 3x40W 230V
555503113 Светильник точечный MINHO 1x50W 230V
332133013 Бра NATHALIE wall lamps black 1x100W 23
361261713 Светильник подвесной GARCIA 4x60W 230V
431464313 Светильник настольный VIOLLA 1x40W
372553113 светильник подвесной FINN 3x23W 230V
372555313 светильник подвесной FINN 3x23W 230V
372585313 Светильник напольный FINN 3x23W 230V 1x3
422161113 светильник напольный MARTI1x23W 230V
362533013 Светильник напольный KYRAN 1x60W 230V
405281113 светильник подвесной THOR 10x20W 12V
374843013 Светильник настольный FLORA 3x40W 230V
404244813 Светильник подвесной MARKKU 1x23W 230
302161713 Светильник потолочный DORA 2x21W 230
404414813 Светильник подвесной KASPAR 3x75W 230V
561564813 Светильник точечный VENUS grey 6x50W 12V
374281113 Светильник напольный MONTI 4x40W 230V
374261113 Светильник подвесной CALIXA 5x50W 230V
374551813 Светильник подвесной CORELLI White 8x40W
370301713 Светильник подвесной DURABO 8x25W 230V
370311713 Светильник потолочный DURABO 7x25W 2
370611113 Светильник потолочный HUMAN 8x20W 12
372928613 Бра LYRIS wall lamps rust 2x40W 230V
677511713 Светильник напольный SINGER 1x50W 12V
374188613 Светильник напольный ARTOIS 1x100W 230V
374311113 Светильник подвесной MARIUS 4x35W 12V
374321113 Бра MARIUS wall lamps chrome 1x35W 12V
361081113 Светильник напольный DUBOIS 1x100W 23
363353113 Светильник подвесной CLEMENT 3x23W 230V
361271713 Бра GARCIA wall lamps nickel 1x40W 230V
372051713 светильник подвесной ROSSINI 1x100W 230V
372384813 светильник напольный MONTOYA 1x60W 230V
371083013 св-к напольный VIADANA 1x60W 230V
405271113 светильник подвесной THOR 10x20W 12V
431587513 св-к настольный ILIO 1x60W 230V
372729213 светильник настенный RAMEAU1x60W 230V
405251113 светильник подвесной ENZO 7x20W 12V
431523013 светильник настольный BOVOS1x60W 230V
371063013 светильник подвесной VIADANA 2x60W 230V
421333113 Светильник напольный lighting products
555134813 Светильник точечный PARABOLIC alum 3x40W
332151713 Бра DORA wall lamps nickel 1x14W 230V
403471713 Светильник подвесной DIABELLI 1x28W 230V
375484813 Светильник напольный ARBEAU alum 1x60W
431463113 Светильник настольный VIOLLA 1x40W 230V
431433013 Светильник настольный BELLINI 1x60W 230V
455593113 Бра VIOLLA wall lamps white 1x60W 230V
404414313 Светильник подвесной KASPAR 3x75W 23
421574813 Светильник напольный KASPAR 3x100W 230V";

$all = explode("\n", $info);
$goods=array();
foreach($all as $s) {	$art = intval($s);	$s = str_replace($art." ", "", $s);
	$full=$s;
	$s = str_ireplace(array("светильник","Светильник","настольный", "потолочный", "подвесной", "напольный", "бра", "настенный", "св-к"), "", $s);
	$goods[$art] ="<input type=text size=100 value='".trim($s)."'>".$full;
}


$dir="../pic/tmp/";
$dir1="../pic/tmp2/";
$f=0;
$nofind=0;

if ($handle = opendir($dir)) {
    while (false !== ($file = readdir($handle))) {
        if ($file != "." && $file != "..") {
            //echo "$dir $file<br>\n";
            $art = intval($file);
            $art_num=$art;

            $art = substr($art, 0,5)."/".substr($art, 5, 2)."/".substr($art, 7 ,2);
            //echo $art;
            $sql="SELECT * FROM goods WHERE art='$art'";
            $r = mysql_query($sql);
            //echo "ok001 ";
            $num++;
            echo "$num)   <a target=_blank href='http://www.lightinside.ru/search.php?q=$art'>url</a> <input size=10 value='Производитель: Eseo'><input size=10 value='$art'>".$goods[$art_num]."<br>";

            if ($row = mysql_fetch_array($r)) if (!file_exists("../pic/medium/1183_0.jpg")){
            	$i=0;
            	//if ($file!=$art.".jpg") $i=1;
            	$fn=$row["id"]."_".$i.".jpg";
            	//echo "$file -> $fn<br>";
            	copy($dir.$file, $dir1.$fn);
            	//echo "ok002 ";

				$res = addpic($dir1.$fn, $row["id"], 0);
            	echo ($res?"OK ":" ОШИБКА уже есть картника ").$row["id"]."<br>";
            	//echo "ok004 ";
            	$f++;            }else echo "$art Существует ../pic/medium/".$row["id"]."_0.jpg<br>";
            else{
	            echo "НЕ НАЙДЕН АРТ '$art'  <br>";
	            $nofind++;
	            }
        }
    }
    closedir($handle);
}


    echo "<br>ВСЕГО: ".$f;
    echo "<br>не найденных $nofind ";


    //////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////
    /////////////////////////////////////////////////////////////////////////////////////

    $r=mq($sql="SELECT  SQL_CALC_FOUND_ROWS g.*, p.price, c.count FROM goods g
		LEFT OUTER JOIN price p ON p.art=g.art
		LEFT OUTER JOIN count c ON c.art=g.art
		WHERE DAYOFYEAR(`date`)=DAYOFYEAR(NOW())");

$r1=mq("SELECT FOUND_ROWS() ");
$all_count = mysql_fetch_array($r1);
$all_count = $all_count [0];

echo "<b><span style='font-size: 15px'>".($name0==""?$name1:$name0)."</span></b> ";

echo "(Всего товаров: $all_count)<br><br>";




//////////////////*
$u=".?m=$m&p=$p&c1=$c1&c2=$c2&cat=".intval($cat);
$nav = "<table width=100%><tr><td aling=left valign=top>";

$page_count = ceil($all_count/$perpage);

if ($page_count>1){
	 $nav .=  "Номер страницы: ";
	for ($i=0; $i<$page_count ; $i++) $nav .=  ($pn==$i?$i:"<a href=$u&perpage=$perpage&pn=$i>$i</a>")." ";
}

$nav .= "</td><td align=right valign=top>Товаров на странице: ";

for ($i=0; $i<count($per_pages); $i++){
	$x=$per_pages[$i];
    $nav .= (($x!=$perpage)?"<a href=$u&perpage=$x&pn=".floor($perpage*$pn/$x).">".$x."</a>":$x)." ";
}
$nav .= "</td></tr></table>";
///////////




?>